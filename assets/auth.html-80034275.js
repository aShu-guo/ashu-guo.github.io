import{_ as t,r,o as c,c as i,a as n,d as e,e as o,b as a}from"./app-a46f6870.js";const p="/imgs/server/jwt-auth-refresh.png",d="/imgs/server/refresh-token-rotation.png",l={},u=a(`<h1 id="è®¤è¯æ¨¡å—" tabindex="-1"><a class="header-anchor" href="#è®¤è¯æ¨¡å—" aria-hidden="true">#</a> è®¤è¯æ¨¡å—</h1><p>é¡¹ç›®çš„è®¤è¯æ¨¡å—æ˜¯åŸºäºtokençš„jwtæ¨¡å¼ã€‚jwtæ¨¡å¼æ˜¯ç”¨æˆ·è®¿é—®æœåŠ¡ç«¯å—é™èµ„æºçš„ä¸€ç§ç­–ç•¥</p><h2 id="jwt" tabindex="-1"><a class="header-anchor" href="#jwt" aria-hidden="true">#</a> jwt</h2><p>å¦‚æœä¹‹å‰ä½¿ç”¨JWTæ¨¡å¼ï¼Œå¹¶ä¸”å­˜å‚¨tokenåˆ°localStorageä¸­çš„æ ¡éªŒç™»å½•æ€ï¼Œåˆ™éœ€è¦è°ƒæ•´ä¸ºå­˜å…¥Cookieä¸­ã€‚</p><p>JWTæ¨¡å¼ä¸­çš„tokenä½¿ç”¨æ–¹å¼ï¼š</p><ul><li>ç™»å½•ç”¨æˆ·ç”¨è´¦å·ã€å¯†ç æ¢å–çš„tokenï¼Œåœ¨å®¢æˆ·ç«¯ä¿å­˜æ—¶æ—¢å¯ä»¥æ”¾åœ¨<code>Cookie</code>ä¸­ï¼Œåˆå¯ä»¥æ”¾åœ¨<code>localStorage</code>ä¸­</li><li>tokenä¸­é—´ç”¨<code>.</code>éš”å¼€åˆ†æˆ3æ®µï¼Œ<code>Header.Payload.Signature</code>å­˜æ”¾æœ‰å…³tokenç±»å‹ã€åŠ å¯†æ–¹å¼ã€ç­¾å‘æ–¹å¼ç­‰ä¿¡æ¯</li><li>å†æ¬¡è¯·æ±‚æ¥å£æ—¶ï¼Œéœ€è¦å°†tokenå¸¦å›æœåŠ¡ç«¯ã€‚æ—¢å¯ä»¥å°†tokenæ”¾åœ¨<code>Cookie</code>ä¸­ï¼ˆä¼šå­˜åœ¨è·¨åŸŸï¼‰ï¼Œåˆå¯ä»¥æ”¾åœ¨è¯·æ±‚å¤´çš„<code>Authorization</code>ä¸­</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>tokenä¸€æ—¦ç­¾å‘ï¼Œæœ‰æ•ˆæœŸåªä¸å¤±æ•ˆæ—¶é—´æœ‰å…³ï¼Œé™¤éæœåŠ¡ç«¯æ·»åŠ é¢å¤–çš„é€»è¾‘ã€‚</li><li>é»˜è®¤ä¸åŠ å¯†ï¼Œéœ€è¦ä¼ è¾“æ•æ„Ÿæ•°æ®æ—¶åˆ™åº”åŠ å¯†</li></ul><h2 id="refresh-token" tabindex="-1"><a class="header-anchor" href="#refresh-token" aria-hidden="true">#</a> refresh token</h2><p>ä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œä¸ä¼šé¢‘ç¹è·³å…¥ç™»å½•é¡µé¢ã€‚æ‰€ä»¥åœ¨è®¤è¯ä¹‹åï¼Œä¹Ÿéœ€è¦å“åº”çš„æä¾›åˆ·æ–°ç­–ç•¥ã€‚å…¶ä¸­åˆ·æ–°tokenæœ‰å¤šç§ç­–ç•¥ï¼Œå¯ä»¥å¤§è‡´åˆ†ä¸º<code>æœåŠ¡ç«¯ä¸»åŠ¨åˆ·æ–°</code> å’Œ<code>å®¢æˆ·ç«¯ä¸»åŠ¨åˆ·æ–°</code>ï¼Œå½“ç„¶ä¹Ÿæœ‰å¦å¤–ä¸€ç§å¹¶ä¸æ”¯æŒçš„æ–¹å¼ï¼šå°½å¯èƒ½å»¶é•¿tokenæœ‰æ•ˆæ—¶é—´ï¼Œä½†æ˜¯è¿™<code>éå¸¸å±é™©âš ï¸</code></p><h3 id="æœåŠ¡ç«¯ä¸»åŠ¨åˆ·æ–°" tabindex="-1"><a class="header-anchor" href="#æœåŠ¡ç«¯ä¸»åŠ¨åˆ·æ–°" aria-hidden="true">#</a> æœåŠ¡ç«¯ä¸»åŠ¨åˆ·æ–°</h3><p>æœåŠ¡ç«¯åœ¨ç”¨æˆ·è®¿é—®æ—¶åˆ¤æ–­tokenæ˜¯å¦æœ‰æ•ˆä»¥åŠå‰©ä½™æœ‰æ•ˆæœŸï¼Œæ— æ•ˆæˆ–è€…å‰©ä½™æ—¶é—´ä¸é•¿ï¼Œåˆ™è¿”å›æ–°tokenç»™å®¢æˆ·ç«¯ã€‚ä½†æ˜¯æœåŠ¡ç«¯æ¯æ¬¡éƒ½å‰ç½®åˆ¤æ–­æ¥å£è¯·æ±‚çš„<code>access_token</code> æ˜¯å¦æœ‰æ•ˆ</p><p>å¯ä»¥åœ¨guideæˆ–è€…middlewareä¸Šæ·»åŠ æ£€æŸ¥<code>tokenæ˜¯å¦æœ‰æ•ˆä»¥åŠå‰©ä½™æœ‰æ•ˆæœŸä¸è¶³</code>çš„åˆ¤æ–­é€»è¾‘ï¼š</p><ol><li>tokenæœ‰æ•ˆï¼Œæ”¾è¡Œ</li><li>tokenå¤±æ•ˆï¼ŒæœåŠ¡ç«¯é‡æ–°ç”Ÿæˆtokenå¹¶åœ¨æœ¬æ¬¡è¯·æ±‚ä¸­è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºæ–°çš„tokenï¼Œå¦‚æœæ˜¯æ–°tokenåˆ™ä½¿ç”¨</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// server</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isExpire</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">access_token</span><span class="token operator">:</span> <span class="token function">genToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// client</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>token <span class="token operator">!==</span> newToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    header<span class="token punctuation">[</span><span class="token string">&#39;Authorization&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> newToken
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å­˜åœ¨å®‰å…¨éšæ‚£ï¼šç”¨æˆ·ä¸€æ—¦ç™»å½•ä¹‹åå°±æ°¸ä¹…è®¤è¯äº†ï¼Œæ•ˆæœç­‰ä»·äºç”¨æˆ·æ‹¥æœ‰ä¸€ä¸ªæ— é™æœ‰æ•ˆæ—¶é•¿çš„tokenï¼›è€Œä¸”å‹åŠ›éƒ½é›†ä¸­åœ¨æœåŠ¡ç«¯ã€‚æ•…ä¸å»ºè®®åœ¨æœåŠ¡ç«¯ä¸»åŠ¨åˆ·æ–°token</p><h3 id="å®¢æˆ·ç«¯ä¸»åŠ¨åˆ·æ–°" tabindex="-1"><a class="header-anchor" href="#å®¢æˆ·ç«¯ä¸»åŠ¨åˆ·æ–°" aria-hidden="true">#</a> å®¢æˆ·ç«¯ä¸»åŠ¨åˆ·æ–°</h3><p>å®¢æˆ·ç«¯è‡ªè¡Œåˆ¤æ–­tokenæ˜¯å¦æœ‰æ•ˆï¼Œæ— æ•ˆæ—¶éœ€è¦ä¸»åŠ¨è¯·æ±‚åˆ·æ–°tokenæ¥å£ï¼Œæ³¨æ„<code>refresh</code>æ¥å£åªèƒ½ç”¨äºåˆ·æ–°tokenï¼Œä¸èƒ½è®¿é—®å…¶ä»–èµ„æºã€‚</p><p>æ—¢ç„¶éœ€è¦å®¢æˆ·ç«¯åˆ¤æ–­ï¼Œé‚£ä¹ˆåœ¨ç™»å½•æ—¶éœ€è¦ä¿å­˜tokenä»¥åŠæœ‰æ•ˆæ—¶é•¿ï¼Œå°†tokenå­˜æ”¾åˆ°çŠ¶æ€ç®¡ç†æ¡†æ¶ï¼ˆex: piniaï¼‰ä¸­ï¼Œå¹¶ä¸”æŒä¹…åŒ–åˆ°<code>localStorage</code>ä¸­ã€‚</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxxx&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// ç”Ÿæˆtokenæ—¶çš„æ—¶é—´æˆ³</span>
  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token comment">// è¿‡æœŸæ—¶é—´ä¸º10åˆ†é’Ÿ</span>
  <span class="token property">&quot;expire&quot;</span><span class="token operator">:</span> <span class="token number">600000</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ¤æ–­é€»è¾‘éœ€è¦æ”¾åœ¨ï¼š</p><ul><li>axiosçš„request interceptor</li><li>è·¯ç”±å®ˆå«</li></ul><p>ä¸ºä»€ä¹ˆä¹Ÿè¦æ”¾åœ¨è·¯ç”±å®ˆå«ä¸­å‘¢ï¼Ÿ</p><p>å› ä¸ºå¯¼èˆªåˆ°æ–°é¡µé¢çš„é’©å­å‡½æ•°ä¸­ä¼šå­˜åœ¨æ¥å£è¯·æ±‚ï¼Œé‚£ä¹ˆæ—¢ç„¶tokenå·²ç»å¤±æ•ˆï¼Œå°±æ²¡å¿…è¦å†å»è¯·æ±‚æ¥å£ã€‚è€Œä¸”å¯¹åº”çš„å“åº”æ‹¦æˆªå™¨ä¸­çš„é”™è¯¯æé†’ï¼š<code>this.$message.error(message)</code> ä¼šè¢«è§¦å‘å¤šæ¬¡ã€‚</p><p>ä½†æ˜¯å®¢æˆ·ç«¯å­˜å‚¨çš„tokenæœ‰æ•ˆæ—¶é•¿å¯èƒ½ä¼šä¸æœåŠ¡ç«¯ä¸ä¸€è‡´ï¼Œå­˜åœ¨10msï½100msçš„å»¶è¿Ÿï¼Œè¿™ä¸ç½‘ç»œæƒ…å†µæœ‰å…³ã€‚</p><p>ç”¨æˆ·åœ¨ç™»å½•æ—¶è¿”å›ä¸¤ä¸ªæœ‰æ•ˆæ—¶é•¿ä¸åŒçš„tokenï¼Œå…¶ä¸­<code>refresh_token</code>æœ‰æ•ˆæœŸè¾ƒé•¿ï¼š</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;access_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxxx&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;refresh_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yyyy&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‡è®¾<code>access_token</code>æœ‰æ•ˆæ—¶é•¿ä¸º10åˆ†é’Ÿï¼Œè€Œ<code>refresh_token</code>æœ‰æ•ˆæ—¶é•¿ä¸º1å¤©ã€‚é‚£ä¹ˆåœ¨å®¢æˆ·ç«¯è¯·æ±‚åˆ°æœåŠ¡ç«¯æ—¶ï¼Œå¦‚æœ<code>access_token</code> å¤±æ•ˆåˆ™éœ€è¦æ‹¿ç€<code>refresh_token</code>å»æœåŠ¡ç«¯æ¢å–æ–°çš„tokenã€‚</p><p>ä½†æ˜¯å¦‚æœç”¨æˆ·ç™»å½•ä¹‹åï¼Œæ²¡æœ‰ä¸å®¢æˆ·ç«¯äº¤äº’ï¼ˆexï¼šé—²ç½®éšè—äº†é¡µé¢æˆ–è€…å»ç©æ¸¸æˆäº†ï¼‰ï¼Œ<code>refresh_token</code>ä¸<code>access_token</code>åŒåŒå¤±æ•ˆå¯¼è‡´ç”¨æˆ·éœ€è¦é‡æ–°ç™»å½•ã€‚</p><p><img src="`+p+'" alt="img.png"></p><h4 id="è½®æ¢refresh-token" tabindex="-1"><a class="header-anchor" href="#è½®æ¢refresh-token" aria-hidden="true">#</a> è½®æ¢refresh token</h4><p>ç”±äº<code>refresh token</code>æœ‰æ•ˆæ—¶é—´è¶³å¤Ÿé•¿ï¼Œé‚£ä¹ˆè¢«æ³„éœ²æ—¶å¯¼è‡´çš„å®‰å…¨é—®é¢˜ä¹Ÿæ˜¯ä¸¥é‡çš„ã€‚</p><p>æ”»å‡»è€…åœ¨<code>access_token</code>å¤±æ•ˆæ—¶ï¼Œé€šè¿‡<code>refresh token</code>é‡æ–°è·å–<code>access_token</code>ç›´åˆ°<code>refresh token</code>å¤±æ•ˆã€‚</p>',33),k=n("code",null,"refresh token",-1),h={href:"https://datatracker.ietf.org/doc/html/draft-ietf-oauth-browser-based-apps-05#section-8",target:"_blank",rel:"nofollow noopener noreferrer"},m=a('<p>ä¸¾ä¸ªğŸŒ°ï¼š</p><p>å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªåº”ç”¨ï¼šmobile appï¼ŒæœåŠ¡ç«¯æä¾›ä¸€ä¸‹è®¤è¯é“¾è·¯ï¼š</p><ol><li>ç”¨æˆ·ç™»å½•ï¼Œè·å–ä¸€å¯¹tokenï¼š<code>access_token</code>å’Œ<code>refresh token</code>ï¼Œå…¶ä¸­<code>access_token</code>æœ‰æ•ˆæ—¶é•¿ä¸º10åˆ†é’Ÿï¼Œ<code>refresh token</code>æœ‰æ•ˆæ—¶é•¿ä¸º2å¹´</li><li>10åˆ†é’Ÿåï¼Œ<code>access_token</code>å¤±æ•ˆï¼Œç”¨æˆ·ä¸æœåŠ¡ç«¯äº¤äº’æ—¶éœ€è¦é¦–å…ˆåˆ·æ–°tokenï¼Œè¯·æ±‚<code>refresh</code>æ¥å£ï¼Œå†æ¬¡è·å–ä¸€å¯¹<code>access_token</code> å’Œ<code>refresh token</code></li><li>æœåŠ¡ç«¯é”€æ¯æ—§<code>refresh token</code></li></ol><p><img src="'+d+'" alt="img.png"></p><h2 id="æ³¨é”€" tabindex="-1"><a class="header-anchor" href="#æ³¨é”€" aria-hidden="true">#</a> æ³¨é”€</h2><p>jwt tokenæ˜¯æ— çŠ¶æ€çš„ï¼Œåªèƒ½åœ¨æœ‰æ•ˆæœŸåˆ°äº†æ‰ä¼šè¢«é”€æ¯ï¼Œé™¤æ­¤ä¹‹å¤–æ˜¯æ— æ³•æ‰‹åŠ¨é”€æ¯çš„ã€‚é‚£ä¹ˆjwtæ¨¡å¼ä¸‹ç”¨æˆ·æ˜¯å¦‚ä½•æ³¨é”€çš„å‘¢ï¼Ÿ</p><p>ç”¨æˆ·æ³¨é”€æ—¶ï¼Œå³ä½¿å®¢æˆ·ç«¯æ¸…é™¤äº†tokenï¼Œåœ¨ä¸‹æ¬¡ä¸æœåŠ¡ç«¯äº¤äº’æ—¶ä¼šæç¤ºï¼š<code>æœªè®¤è¯</code>ã€‚ä½†æ˜¯tokenå¦‚æœè¿˜åœ¨æœ‰æ•ˆæœŸï¼Œå®ƒä¾ç„¶å¯ä»¥ç”¨æ¥ä¸æœåŠ¡ç«¯äº¤äº’ã€‚</p><p>æ—¢ç„¶æ— æ³•é”€æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æŠŠéæ³•çš„tokenå­˜èµ·æ¥ï¼Œæ”¾åˆ°ä¸€ä¸ª<code>&quot;é»‘åå•&quot;</code>ä¸­ï¼Œç”¨rediså­˜å‚¨å†åˆé€‚ä¸è¿‡äº†ã€‚</p><h2 id="å®è·µ" tabindex="-1"><a class="header-anchor" href="#å®è·µ" aria-hidden="true">#</a> å®è·µ</h2><p>å‚è€ƒï¼š</p>',10),f={href:"https://learnku.com/articles/7264/using-jwt-auth-to-implement-api-user-authentication-and-painless-refresh-access-token",target:"_blank",rel:"nofollow noopener noreferrer"},v={href:"https://katifrantz.com/the-ultimate-guide-to-jwt-server-side-authentication-with-refresh-tokens",target:"_blank",rel:"nofollow noopener noreferrer"},_={href:"https://security.stackexchange.com/questions/119371/is-refreshing-an-expired-jwt-token-a-good-strategy",target:"_blank",rel:"nofollow noopener noreferrer"},g={href:"https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html",target:"_blank",rel:"nofollow noopener noreferrer"};function b(x,w){const s=r("ExternalLinkIcon");return c(),i("div",null,[u,n("p",null,[e("æ‰€ä»¥åº”è¯¥è½®æ¢"),k,e(" ï¼Œé™åˆ¶å®ƒåªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œè¿™ä¹Ÿæ˜¯äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„æ¨èçš„"),n("a",h,[e("ç­–ç•¥"),o(s)]),e("ã€‚")]),m,n("p",null,[e("ã€1ã€‘"),n("a",f,[e("ä½¿ç”¨ Jwt-Auth å®ç° API ç”¨æˆ·è®¤è¯ä»¥åŠæ— ç—›åˆ·æ–°è®¿é—®ä»¤ç‰Œ"),o(s)])]),n("p",null,[e("ã€2ã€‘"),n("a",v,[e("The Ultimate Guide to JWT server-side auth (with refresh tokens)"),o(s)])]),n("p",null,[e("ã€3ã€‘"),n("a",_,[e("Is refreshing an expired JWT token a good strategy?"),o(s)])]),n("p",null,[e("ã€4ã€‘"),n("a",g,[e("JSON Web Token å…¥é—¨æ•™ç¨‹"),o(s)])])])}const q=t(l,[["render",b],["__file","auth.html.vue"]]);export{q as default};
