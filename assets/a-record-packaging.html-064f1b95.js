import{_ as o,r as t,o as p,c as l,a as n,d as s,e,b as c}from"./app-a46f6870.js";const i={},r=n("h1",{id:"将vue2项目打包为win应用记录",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#将vue2项目打包为win应用记录","aria-hidden":"true"},"#"),s(" 将vue2项目打包为win应用记录")],-1),u=n("p",null,"一个事业单位的招投标项目，需求已经开发完毕，但是对方希望得到的是一个桌面程序，而不是将其部署到服务器上。",-1),d=n("h2",{id:"vue-cli-plugin-electron-builder",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#vue-cli-plugin-electron-builder","aria-hidden":"true"},"#"),s(" vue-cli-plugin-electron-builder")],-1),v=n("code",null,"vue-cli",-1),k={href:"https://github.com/nklayman/vue-cli-plugin-electron-builder",target:"_blank",rel:"nofollow noopener noreferrer"},m=n("code",null,"electron",-1),b=n("code",null,"vue-cli-plugin-electron-builder",-1),g=c(`<div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>需要保证项目是基于vue-cli的</p></div><p>在项目目录下执行</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>vue <span class="token function">add</span> electron-builder
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>执行命令之后，插件会向项目中添加两个<code>scripts</code>：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    ...
    <span class="token property">&quot;electron:build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service electron:build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;electron:serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service electron:serve&quot;</span><span class="token punctuation">,</span>
    ...
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="运行开发服务" tabindex="-1"><a class="header-anchor" href="#运行开发服务" aria-hidden="true">#</a> 运行开发服务</h3><p>如果项目使用的依赖管理是yarn，执行：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">yarn</span> electron:serve
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果项目使用的依赖管理是npm，执行：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run electron:serve
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="构建项目" tabindex="-1"><a class="header-anchor" href="#构建项目" aria-hidden="true">#</a> 构建项目</h3><p>如果项目使用的依赖管理是yarn，执行：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">yarn</span> electron:build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果项目使用的依赖管理是npm，执行：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run electron:build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>此时构建并没有指定build的环境变量，而且也没有指定构建产物的平台。默认是构建出<code>NODE_ENV=production</code>的产物，target默认为当前系统平台。</p><p>例如：在mac上构建时，构建出的可执行文件是dmg文件；在windows上构建时，构建出的可执行文件是exe文件</p><h3 id="指定环境变量以及平台" tabindex="-1"><a class="header-anchor" href="#指定环境变量以及平台" aria-hidden="true">#</a> 指定环境变量以及平台</h3><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    ...
    <span class="token property">&quot;electron:build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service electron:build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;electron:serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service electron:serve&quot;</span><span class="token punctuation">,</span>
    ...
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改为：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    ...
    <span class="token property">&quot;electron:build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service electron:build  --mode prod_gray --win&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;electron:serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service electron:serve&quot;</span><span class="token punctuation">,</span>
    ...
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行<code>electron:build</code>时，会去寻找<code>.env.prod_gray</code>名的环境变量文件，打包产物是exe</p><h2 id="遇到的问题" tabindex="-1"><a class="header-anchor" href="#遇到的问题" aria-hidden="true">#</a> 遇到的问题</h2><h3 id="依赖安装" tabindex="-1"><a class="header-anchor" href="#依赖安装" aria-hidden="true">#</a> 依赖安装</h3><p>下载electron包时出现<code>RequestError: read ECONNRESET</code>问题</p><p><strong>方案1：</strong></p><ul><li>先执行<code>npm install</code>，在控制台上运行到<code>node install.js</code>时中断执行（ctrl+c）</li><li>进入<code>node_modules/electron</code>文件下， 编辑<code>install.js</code></li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">downloadArtifact</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    version<span class="token punctuation">,</span>
    <span class="token literal-property property">artifactName</span><span class="token operator">:</span> <span class="token string">&#39;electron&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">force</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>force_no_cache <span class="token operator">===</span> <span class="token string">&#39;true&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cacheRoot</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>electron_config_cache<span class="token punctuation">,</span>
    <span class="token literal-property property">platform</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_config_platform <span class="token operator">||</span> process<span class="token punctuation">.</span>platform<span class="token punctuation">,</span>
    <span class="token literal-property property">arch</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_config_arch <span class="token operator">||</span> process<span class="token punctuation">.</span>arch<span class="token punctuation">,</span>
    <span class="token literal-property property">mirrorOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">mirror</span><span class="token operator">:</span> <span class="token string">&#39;https://npm.taobao.org/mirrors/electron/&#39;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>extractFile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>再次执行<code>npm install</code></li></ul><p>不建议，需要手动更改<code>node_modules</code></p><p><strong>方案2：</strong></p><ul><li>设置npm下载electron镜像地址</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token builtin class-name">set</span> ELECTRON_MIRROR https://registry.npmmirror.com/mirrors/electron/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>再次执行<code>npm install</code></li></ul><p><strong>方案3：</strong></p><p>预安装：手动下载对应平台的文件，放到对应的目录下。这样在执行<code>npm install</code>时会自动跳过安装</p><p>不同平台对应的目录：</p><ul><li><code>Linux: $XDG_CACHE_HOME or ~/.cache/electron/</code></li><li><code>macOS: ~/Library/Caches/electron/</code></li><li><code>Windows: $LOCALAPPDATA/electron/Cache or ~/AppData/Local/electron/Cache/</code></li></ul><h3 id="viser-vue" tabindex="-1"><a class="header-anchor" href="#viser-vue" aria-hidden="true">#</a> viser-vue</h3><p>打包之后运行可执行文件时报错：Cannot assign to read only property &#39;constructor&#39; of object <code>#&lt;t&gt;</code></p><p>报错文件指向：<code>g2-plugin-slider.js</code>，而且项目中引入了<code>viser-vue</code></p><p>分析<code>package-lock.json</code>文件，发现是<code>viser-vue</code>依赖<code>@antv/g2-plugin-slider</code></p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;node_modules/viser&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.4.9&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;resolved&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://registry.npmjs.org/viser/-/viser-2.4.9.tgz&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;integrity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sha512-DKsqtMa3TZYQHEZ7jp4kpNp1Iqomda7d+3IkkIjIdKQvfL8OeksXfy/ECZUY1hTrGoOe7cq85+6PMS+MPn4mgQ==&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;@antv/g2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;~3.5.3&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;@antv/g2-brush&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.0.2&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;@antv/g2-plugin-slider&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.1.0&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;@types/d3-format&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;@types/lodash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;@types/node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^8.0.53&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;d3-format&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.3.0&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;lodash&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.17.4&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>原因是<code>vue-cli</code>的<code>morden</code>模式导致的产物兼容问题，显式指定打包模式即可：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    ...
    <span class="token property">&quot;electron:build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service electron:build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;electron:serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service electron:serve&quot;</span><span class="token punctuation">,</span>
    ...
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改为：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    ...
    <span class="token property">&quot;electron:build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service electron:build --legacy --mode prod_gray --win&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;electron:serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-cli-service electron:serve&quot;</span><span class="token punctuation">,</span>
    ...
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以在<code>index.html</code>中引入外部cdn解决</p><h3 id="build失败" tabindex="-1"><a class="header-anchor" href="#build失败" aria-hidden="true">#</a> build失败</h3><p>执行<code>electron:build</code>时报错：⨯ Exit code: ENOENT. spawn /usr/bin/python ENOENT</p><p>原因是<code>electron-builder</code>版本过低导致</p><p>解决方案是修改package.json文件，覆盖<code>electron-builder</code>版本：</p><p>使用的是<code>yarn</code>：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;resolutions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;vue-cli-plugin-electron-builder/electron-builder&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^23.0.3&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用的是<code>npm</code>：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;overrides&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;vue-cli-plugin-electron-builder&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;electron-builder&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^23.0.3&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参考：</p>`,57),h={href:"https://www.electronjs.org/zh/docs/latest/tutorial/installation",target:"_blank",rel:"nofollow noopener noreferrer"},q={href:"https://github.com/nklayman/vue-cli-plugin-electron-builder/issues/1089",target:"_blank",rel:"nofollow noopener noreferrer"},y={href:"https://github.com/antvis/G2/pull/1641",target:"_blank",rel:"nofollow noopener noreferrer"},_={href:"https://github.com/electron-userland/electron-builder/issues/6726",target:"_blank",rel:"nofollow noopener noreferrer"};function f(x,j){const a=t("ExternalLinkIcon");return p(),l("div",null,[r,u,d,n("p",null,[s("由于项目是基于"),v,s(" 构建的，而"),n("a",k,[s("vue-cli-plugin-electron-builder"),e(a)]),s(" 是方便开发者将vue项目打包通过"),m,s("打包为桌面程序的插件。并且项目也满足使用"),b,s("的前置条件")]),g,n("p",null,[s("【1】"),n("a",h,[s("Electron 安装指导"),e(a)])]),n("p",null,[s("【2】"),n("a",q,[s("ant-design-vue-pro 使用 electron 打包后运行时报错"),e(a)])]),n("p",null,[s("【3】"),n("a",y,[s("https://github.com/antvis/G2/pull/1641"),e(a)])]),n("p",null,[s("【4】"),n("a",_,[s("Exit code: ENOENT. spawn /usr/bin/python error after updating macOS"),e(a)])])])}const w=o(i,[["render",f],["__file","a-record-packaging.html.vue"]]);export{w as default};
