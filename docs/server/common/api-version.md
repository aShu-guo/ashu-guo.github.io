# api版本

1. 对于break change，api生产者会内部变更api版本，api消费者可以自行决定是继续使用当前版本，还是迁移到最新版本，可以更好的渐进式开发。
2. 对于微服务架构而言，添加api版本可以有效解决接口杂乱、不可追溯问题，并且让接口具备更强的可扩展性、可靠性和灵活性。

综上可知，添加版本控制对于api消费者是友好的，但是api生产者的成本更高。所以就成本收益而言，我认为对于需要对外暴露出的api应该使用`version`
控制，但是对于公司内部非底层的服务无需使用。

如何保证多个不同版本可以共存？

可以通过不同分支实现，这对于分支维护也是一个挑战。

## 实现

有多种方式可以添加api版本

### 通过路由-params

```text
https://www.test.com/api/1/catalog
```

### 通过请求-query

```text
https://www.test.com/api/catalog?version=1
```

### 自定义header

```text
Curl -H "accepts-versions: 1:
```

## gateway

网关作为service和client的中间层，是所有微服务的入口，中心化的统一处理认证、限制请求频率、预防攻击等问题。

允许多个版本的service共存，防止未迁移api消费者失效。

如果api版本变更时，网关会自动路由到指定end
point，当api消费者没有迁移到最新版本时会自动降级到兼容版本。虽然允许api消费者非必须迁移，但是应提醒api消费者尽可能去迁移，如：提供最后支持时间。

